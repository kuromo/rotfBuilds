/*! rotfBuilds - v0.0.0 - 2019-01-17
* Copyright (c) 2019 ;*/

var gSrv="http://localhost:3000/";function importTree(){srvPost("importTree",console.log,{tree:JSON.stringify(tree)})}function getTree(){srvGet("getTree",function(t){console.log(t)})}function ceckStart(){if($(".start").hasClass("activeNode"))return!0;console.log("select start")}function secStart(t){$(".activeNode.start").toggleClass("activeNode"),$(t).toggleClass("activeNode");var e=checkUncon();e&&console.log(e),calcTreeStat()}function getAdjac(t){var e,r=parseInt(t.split("c")[0].replace(/r/g,"")),a=parseInt(t.split("c")[1]),s={};1!=r&&checkAloc(r-1,a)&&(s[(e=$(".tile[data-id='r"+(r-1)+"c"+a+"']")).attr("data-id")]=e);13!=a&&checkAloc(r,a+1)&&(s[(e=$(".tile[data-id='r"+r+"c"+(a+1)+"']")).attr("data-id")]=e);15!=r&&checkAloc(r+1,a)&&(s[(e=$(".tile[data-id='r"+(r+1)+"c"+a+"']")).attr("data-id")]=e);1!=a&&checkAloc(r,a-1)&&(s[(e=$(".tile[data-id='r"+r+"c"+(a-1)+"']")).attr("data-id")]=e);return!!hasProp(s)&&s}function checkAloc(t,e){return $(".tile[data-id='r"+t+"c"+e+"']").hasClass("activeNode")}function updateStats(t){var e="";for(var r in t){var a=t[r];Number.isInteger(a)&&0!==a&&(e+=r,e+=":  ",e+=a,e+="<br>")}$("#tStatCont").html(e);var s=$(".activeNode");$(".ptCount").text(s.length)}function calcTreeStat(){var a=new TStats;$(".activeNode").each(function(){var t=$(this).data("id"),e=t.split("c")[0],r="c"+t.split("c")[1];"start"==tree[e][r].type?calcStart(tree[e][r].val,a):a[tree[e][r].type]+=tree[e][r].val}),updateStats(a)}function calcStart(t,e){for(var r in stNodes[t])e[r]+=stNodes[t][r]}function TStats(){this.vit=0,this.vitPre=0,this.dex=0,this.dexPre=0,this.lootPre=0,this.mp=0,this.mpPre=0,this.eva=0,this.evaPre=0,this.spd=0,this.spdPre=0,this.hp=0,this.hpPre=0,this.wis=0,this.wisPre=0,this.rof=0,this.atk=0,this.atkPre=0,this.def=0,this.defPre=0}function login(){var t=$("#usrName").val(),e=$("#usrPwd").val();console.log(t+"   "+e),srvPost("login",console.log,{usrName:t,pwd:e})}function logout(){srvGet("logout",console.log)}function register(){var t={usrName:$("#usrName").val(),mail:$("#mail").val(),firstName:$("#firstName").val(),lastName:$("#lastName").val(),pwd:$("#usrPwd").val()};console.log(t),srvPost("register",console.log,t)}function forgot(){var t=$("#mail").val();srvPost("forgot",console.log,{mail:t})}function reset(){var t=$("#usrPwd").val();srvPost(window.location.pathname.substring(1),console.log,{pwd:t})}function srvGet(t,e,r){$.ajax({type:"GET",data:{},url:gSrv+t,beforeSend:function(){},success:function(t){return console.log(t.redirect),t.redirect&&(document.location.href=t.redirect),r?e(t,r):e(t),t},error:function(t){console.log(t),outputError(t)}})}function srvPost(t,e,r){$.ajax({type:"POST",url:gSrv+t,data:r,beforeSend:function(){},success:function(t){return console.log(t.redirect),t.redirect&&(document.location.href=t.redirect),e(t),t},error:function(t){console.log(t),outputError(t)}})}function outputError(t){}function hasProp(t){for(var e in t)if(t.hasOwnProperty(e))return!0;return!1}function checkUncon(){for(var t=breadthFirst(),e=$(".activeNode"),r={},a=0;a<e.length;a++){var s=$(e[a]).attr("data-id");t[s]||(r[s]=e[a])}return!!hasProp(r)&&r}function breadthFirst(){for(var t=$(".activeNode.start"),e={},r=[e[$(t).attr("data-id")]=t];r.length;){var a=r.shift(),s=getAdjac($(a).attr("data-id"));for(var o in s){var i=s[o];e[o]||(e[o]=i,r.push(i))}}return e}$(function(){skrollr.init()}),$(function(){$(".tile").click(function(){console.log(this);var t=$(".activeNode");if(!$(this).hasClass("start")&&!ceckStart())return!1;if($(this).hasClass("start")&&!$(".activeNode").hasClass("start"));else if($(this).hasClass("activeNode")){if($(this).hasClass("start")&&1!=t.length)return console.log("cant remove start"),!1}else{if(!getAdjac($(this).data("id")))return console.log("not connected to start"),!1;if(!(t.length<82))return console.log("no poits left"),!1;if($(this).hasClass("start"))return secStart(this),!1}$(this).toggleClass("activeNode");var e=checkUncon();e&&console.log(e),calcTreeStat()})}),TStats.prototype.getFlat=function(){return{vit:this.vit,dex:this.dex,mp:this.mp,eva:this.eva,spd:this.spd,hp:this.hp,wis:this.wis,rof:this.rof,atk:this.atk,def:this.def}},TStats.prototype.getPre=function(){return{vitPre:this.vitPre,dexPre:this.dexPre,lootPre:this.lootPre,mpPre:this.mpPre,evaPre:this.evaPre,spdPre:this.spdPre,hpPre:this.hpPre,wisPre:this.wisPre,atkPre:this.atkPre,defPre:this.defPre}},$(function(){$("#navLogBtn").click(function(){if($("#navUsr").attr("hidden"))$("#navUsr").attr("hidden",!1),$("#navPwd").attr("hidden",!1);else{var t=$("#navUsr").val(),e=$("#navPwd").val();srvPost("login",console.log,{usrName:t,pwd:e})}})});